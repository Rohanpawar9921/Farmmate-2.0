{% extends 'base.html' %}
{% load static %}
{% load form_filters %}

{% block title %}My Dashboard - Farm-Mate{% endblock %}

{% block extra_css %}
<style>
  .profile-container {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .profile-sidebar {
    border-right: 1px solid #eee;
  }
  
  .profile-nav .nav-link {
    color: #555;
    border-radius: 0;
    padding: 12px 20px;
    border-left: 4px solid transparent;
  }
  
  .profile-nav .nav-link:hover {
    background-color: rgba(46, 125, 50, 0.05);
  }
  
  .profile-nav .nav-link.active {
    background-color: rgba(46, 125, 50, 0.1);
    color: var(--primary);
    border-left: 4px solid var(--primary);
    font-weight: 600;
  }
  
  .dashboard-card {
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    transition: all 0.3s;
  }
  
  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
  }
  
  .calendar-event {
    padding: 8px;
    border-radius: 4px;
    margin-bottom: 8px;
    border-left: 3px solid var(--primary);
  }
  
  .welcome-banner {
    background-color: rgba(46, 125, 50, 0.05);
    border-left: 4px solid var(--primary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 2rem;
  }
  
  .no-posts-message {
    padding: 2rem;
    text-align: center;
    color: #6c757d;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row profile-container">
    <!-- Sidebar -->
    <div class="col-md-3 profile-sidebar py-4">
      <div class="text-center mb-4">
        <div class="profile-picture-container">
          <img src="{{ profile_pic_url|default:user.profile.profile_picture.url }}" alt="Profile Picture" class="profile-picture">
        </div>
        <h5 class="mb-1">{{ user.get_full_name|default:user.username }}</h5>
        <p class="text-muted mb-3">{{ user.profile.farmer_type|title }} Farmer</p>
      </div>
      
      <ul class="nav flex-column profile-nav">
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'dashboard' %}active{% endif %}" href="{% url 'dashboard' %}">
            <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'profile' %}active{% endif %}" href="{% url 'profile' %}">
            <i class="fas fa-user mr-2"></i> My Profile
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'croprecommendation' %}">
            <i class="fas fa-seedling mr-2"></i> Crop Recommendations
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'settings' %}active{% endif %}" href="{% url 'settings' %}">
            <i class="fas fa-cog mr-2"></i> Settings
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'logout' %}">
            <i class="fas fa-sign-out-alt mr-2"></i> Logout
          </a>
        </li>
      </ul>
    </div>
    
    <!-- Main Content -->
    <div class="col-md-9 py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">My Dashboard</h2>
        <div class="text-muted">
          <i class="far fa-calendar-alt mr-2"></i>{{ date_today|date:"F j, Y" }}
        </div>
      </div>
      
      <!-- Welcome Banner -->
      <div class="welcome-banner mb-4">
        <h4>Welcome to Farm-Mate, {{ user.get_full_name|default:user.username }}!</h4>
        <p class="mb-0">Use our crop recommendation tool to get personalized suggestions for your farm based on soil conditions. Engage with the farming community to share knowledge and experiences.</p>
      </div>
      
      <!-- Dashboard Content -->
      <div class="row">
        <!-- Left Column -->
        <div class="col-lg-8">
          <!-- Crop Recommendation Link -->
          <div class="card mb-4 dashboard-card">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-leaf text-success mr-2"></i>Crop Recommendations
              </h5>
              <p class="card-text">Get personalized crop recommendations based on your soil conditions, climate, and other factors.</p>
              <a href="{% url 'croprecommendation' %}" class="btn btn-primary">
                <i class="fas fa-seedling mr-2"></i>Get Crop Recommendations
              </a>
            </div>
          </div>
          
          <!-- Recent Community Activity -->
          <div class="card dashboard-card mb-4">
            <div class="card-header bg-white">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Community Activity</h5>
                <a href="{% url 'post_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
              </div>
            </div>
            <div class="card-body">
              {% if recent_posts %}
                {% for post in recent_posts %}
                  <div class="media {% if not forloop.last %}mb-4{% endif %}">
                    <img src="{{ post.author.profile.profile_picture.url }}" class="mr-3 rounded-circle" width="50" height="50">
                    <div class="media-body">
                      <div class="d-flex justify-content-between">
                        <h6 class="mt-0">{{ post.author.username }}</h6>
                        <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                      </div>
                      <p class="mb-1"><strong>{{ post.title }}</strong></p>
                      <p>{{ post.content|truncatechars:100 }}</p>
                      <div>
                        <a href="{% url 'post_detail' post.id %}" class="btn btn-sm btn-outline-primary">
                          <i class="far fa-comment mr-1"></i>Reply ({{ post.comments.count }})
                        </a>
                      </div>
                    </div>
                  </div>
                  {% if not forloop.last %}<hr>{% endif %}
                {% endfor %}
              {% else %}
                <div class="no-posts-message">
                  <i class="far fa-comments fa-3x mb-3"></i>
                  <h5>No community posts yet</h5>
                  <p>Be the first to start a discussion!</p>
                  <a href="{% url 'post_create' %}" class="btn btn-primary">Create Post</a>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Right Column -->
        <div class="col-lg-4">
          <!-- Quick Links -->
          <div class="card mb-4 dashboard-card">
            <div class="card-header bg-white">
              <h5 class="mb-0">Quick Links</h5>
            </div>
            <div class="card-body">
              <div class="list-group list-group-flush">
                <a href="{% url 'profile' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                  <i class="fas fa-user-edit mr-3 text-primary"></i>
                  <div>
                    <h6 class="mb-1">Update Profile</h6>
                    <small class="text-muted">Keep your information up-to-date</small>
                  </div>
                </a>
                <a href="{% url 'post_list' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                  <i class="fas fa-users mr-3 text-success"></i>
                  <div>
                    <h6 class="mb-1">Community Forum</h6>
                    <small class="text-muted">Connect with other farmers</small>
                  </div>
                </a>
                <a href="{% url 'resources' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                  <i class="fas fa-book-open mr-3 text-warning"></i>
                  <div>
                    <h6 class="mb-1">Resources</h6>
                    <small class="text-muted">Farming guides and articles</small>
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <!-- Soil Health Tips -->
          <div class="card dashboard-card">
            <div class="card-header bg-white">
              <h5 class="mb-0">Soil Health Tips</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <h6><i class="fas fa-check-circle text-success mr-2"></i>Crop Rotation</h6>
                <p class="small text-muted mb-0">Practice crop rotation to prevent pest buildup and improve soil health.</p>
              </div>
              
              <div class="mb-3">
                <h6><i class="fas fa-check-circle text-success mr-2"></i>Soil Testing</h6>
                <p class="small text-muted mb-0">Regular soil testing helps monitor nutrient levels and pH.</p>
              </div>
              
              <div class="mb-0">
                <h6><i class="fas fa-check-circle text-success mr-2"></i>Cover Crops</h6>
                <p class="small text-muted mb-0">Plant cover crops during off-seasons to prevent erosion.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}